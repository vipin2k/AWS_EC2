pipeline {
    agent any

    stages {
        stage('Connect to EC2 via SSH') {
            steps {
                script {
                    def remoteServer = [
                        name: 'dev',
                        host: '13.233.224.136',
                        port: 22,  // Default SSH port
                        credentialsId: '13.233.224.136'
                    ]

                    // Set the correct permissions for the private key file
                    // Note: Use 'bat' for Windows and 'sh' for Unix-like systems
                    if (isUnix()) {
                        sh "chmod 600 /home/ubuntu/jenkins-keypair.pem"
                    } else {
                        bat "chmod 600 /home/ubuntu/jenkins-keypair.pem"
                    }

                    // Add the private key to the SSH agent
                    sshagent(credentials: ['13.233.224.136']) {
                        // Connect to the EC2 instance
                        // Note: Use 'bat' for Windows and 'sh' for Unix-like systems
                        if (isUnix()) {
                            sh """
                                ssh -o StrictHostKeyChecking=no -i "/home/ubuntu/jenkins-keypair.pem" ubuntu@${remoteServer.host} 'ls -l'
                            """
                        } else {
                            bat """
                                ssh -o StrictHostKeyChecking=no -i "/home/ubuntu/jenkins-keypair.pem" ubuntu@${remoteServer.host} 'ls -l'
                            """
                        }
                    }
                }
            }
        }
    }
}
